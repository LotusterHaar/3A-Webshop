<?php
require_once($_SERVER['DOCUMENT_ROOT'].'/../protectedfunctions/generalfunctions.php');
require_once($_SERVER['DOCUMENT_ROOT'].'/../protectedfunctions/dbfunctions.php');

//Get extra info about the category
$database = db_con();
$sql = "SELECT * FROM `orders`";
$stmt = $database->prepare($sql);
$stmt->execute();
$bestellingen= $stmt->fetchAll(PDO::FETCH_ASSOC);
$database=null;
?>

<section class="content">
    <div class="buttonRow">
        <button class="button buttonShopMore"><a href="/webshop"> <i class="fas fa-shopping-basket"></i> Verder winkelen </a></button>
    </div>
    <h1 id="headingOrderHistory">Mijn bestellingsgeschiedenis</h1>
    <?php foreach($bestellingen as $serializedWinkelwagenBestellingen){
        $winkelwagenBestellingen = unserialize($serializedWinkelwagenBestellingen['Cart']);
        foreach($winkelwagenBestellingen as $bestelling)
        {

            //Get extra info about the category
            $database = db_con();
            $sql = "SELECT `SKU`, `ProductName`, `Picture_Big` FROM `product` WHERE Disabled!=1 AND SKU=:SKU;";
            $stmt = $database->prepare($sql);
            $stmt->execute( [
            ':SKU' => $bestelling['SKU'],
            ]);
            $artikelinfo = $stmt->fetch(PDO::FETCH_ASSOC);
            $database=null;

            echo(' <div class="orderedArticle"><article><p>');
            echo($serializedWinkelwagenBestellingen['Date'].' | Bestelnummer '.$serializedWinkelwagenBestellingen['OrderID']);
            echo('</p><hr><div class="clearfix">');?>
            <img src="/webshop/producten/images/<?php echo ($artikelinfo['Picture_Big']);?>"  class="websitephoto" alt="Image <?php echo (trim($artikelinfo['ProductName'])); ?>">
            <p><strong>&nbsp;<?php echo($bestelling['Aantal'].'x '.$artikelinfo['ProductName']);?>
            </strong></p></div>
            </article>
            </div>
        <?php }
    }?>

</section>